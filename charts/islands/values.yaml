# Default values for islands Helm chart

# Number of replicas
replicaCount: 1

image:
  repository: ghcr.io/panbanda/islands
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use
  name: ""

podAnnotations: {}

podSecurityContext:
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

securityContext:
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
      - ALL

service:
  type: ClusterIP
  mcpPort: 8080
  webhookPort: 9000

ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: islands.example.com
      paths:
        - path: /
          pathType: Prefix
          port: mcp
    - host: islands-webhook.example.com
      paths:
        - path: /webhook
          pathType: Prefix
          port: webhook
  tls: []
  #  - secretName: islands-tls
  #    hosts:
  #      - islands.example.com

resources:
  requests:
    memory: "512Mi"
    cpu: "250m"
  limits:
    memory: "2Gi"
    cpu: "1000m"

nodeSelector: {}

tolerations: []

affinity: {}

# Islands configuration
config:
  debug: false
  logLevel: INFO
  syncInterval: 300
  maxConcurrentSyncs: 4
  mcp:
    host: "0.0.0.0"
    port: 8080
  webhook:
    enabled: true
    port: 9000
  storage:
    basePath: /data/islands
    reposPath: /data/islands/repos
    indexesPath: /data/islands/indexes
    cachePath: /data/islands/cache
  leann:
    backend: hnsw
    noRecompute: true
    chunkSize: 512
    chunkOverlap: 64

# Secrets configuration
secrets:
  # OpenAI API key for embeddings and agent
  openaiApiKey: ""
  # GitHub provider
  github:
    token: ""
    webhookSecret: ""
  # GitLab provider (optional)
  gitlab:
    token: ""
    webhookSecret: ""
  # Bitbucket provider (optional)
  bitbucket:
    token: ""
  # Gitea provider (optional)
  gitea:
    token: ""

# External secrets (if using external-secrets operator or similar)
externalSecrets:
  enabled: false
  secretStoreRef:
    name: ""
    kind: ClusterSecretStore
  data: []

# SSH keys for private repository access
sshKeys:
  enabled: false
  # Private key content (base64 encoded) or use existingSecret
  privateKey: ""
  existingSecret: ""

# Persistence configuration
persistence:
  enabled: true
  storageClass: "efs-sc"
  accessModes:
    - ReadWriteMany
  size: 100Gi
  annotations: {}
  # Use existing PVC
  existingClaim: ""

# CronJob for periodic sync
cronJob:
  enabled: true
  schedule: "*/30 * * * *"
  concurrencyPolicy: Forbid
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 3
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "1Gi"
      cpu: "500m"

# Liveness and readiness probes
probes:
  liveness:
    enabled: true
    initialDelaySeconds: 10
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
  readiness:
    enabled: true
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

# Pod Disruption Budget
podDisruptionBudget:
  enabled: false
  minAvailable: 1
  # maxUnavailable: 1

# Horizontal Pod Autoscaler
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 5
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80
